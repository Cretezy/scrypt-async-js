<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>scrypt-async-modern demo</title>
    <style>
        html,
        body {
            font-family: sans-serif;
        }

        #out {
            margin-top: 10px;
            padding: 10px 5px;
            color: #444;
            line-height: 1.5;
        }

        #out small {
            padding: 5px;
            background-color: #eee;
        }

        #N {
            margin-left: 10px;
            color: #aaa;
        }
    </style>
</head>

<body>
<h1><a href="https://github.com/Cretezy/scrypt-async-modern">scrypt-async-modern</a> demo</h1>
<form>
    <p>
        <label for="password">Password:</label>
        <input id="password" name="password" type="text" value="password" size="32">
    </p>
    <p>
        <label for="salt">Salt:</label>
        <input id="salt" name="salt" type="text" value="salt" size="32">
    </p>
    <p>
        <label for="interruptStep">interruptStep:</label>
        <input id="interruptStep" name="interruptStep" type="text" value="0" size="8">
    </p>
    <p>
        <label for="logN">logN:</label>
        <input id="logN" name="logN" type="text" value="11" size="4"
               onkeypress="updateN()" onkeyup="updateN()"
               onblur="updateN()" onchange="updateN()">
        <span id="N" />
    </p>
    <p>
        <label for="r">r:</label>
        <input id="r" name="r" type="text" value="8" size="4">
    </p>
    <p>
        <label for="p">p:</label>
        <input id="p" name="p" type="text" value="1" size="4">
    </p>
    <p>
        <label for="encoding">Encoding:</label>
        <select id="encoding" name="encoding">
            <option value="hex" selected>hex</option>
            <option value="base64">base64</option>
            <option value="binary">binary</option>
        </select>
    </p>
    <div id="submit">
        <input type="submit" name="btn" value="Calculate" />
    </div>
</form>

<div id="out"></div>

<script type="module">
	import scrypt from "./src/index.js"

	const form = document.forms[0];

	function updateN() {
		const fN = document.querySelector('#N');
		const logN = form.logN.value;
		fN.innerHTML = 'N = ' + Math.pow(2, logN);
	}

	const getTime = typeof performance !== "undefined"
		? performance.now.bind(performance)
		: Date.now.bind(Date);

	function calculate() {

		const btn = form.btn;
		const out = document.querySelector('#out');

		const password = form.password.value;
		const salt = form.salt.value;
		const interruptStep = form.interruptStep.value;
		const logN = form.logN.value;
		const r = form.r.value;
		const p = form.p.value;
		const encoding = form.encoding.value;

		btn.disabled = true;
		btn.value = 'Wait...';

		window.setTimeout(() => {
			try {
				const t1 = getTime();
				scrypt(password, salt, {
					logN: logN,
					r: r,
					p: p,
					dkLen: 32,
					interruptStep: interruptStep,
					encoding: encoding
				}).then(
					(res) => {
						const t2 = getTime() - t1;
						out.innerHTML = `Time: <b>${t2}ms</b><br>Result: <small>${res}</small>`;
						btn.disabled = false;
						btn.value = 'Calculate';
					});
			} catch (ex) {
				out.innerHTML = '<span style="color:red">error: ' + ex.message + '</span>';
				btn.disabled = false;
				btn.value = 'Calculate';
			}
		});
	}

	updateN();

	form.onsubmit = event => {
		event.preventDefault();
		calculate();
	};
</script>
<script defer nomodule>
	document.getElementById("submit").innerHTML = "<h3>Sorry, this demo is build for browsers with ES6 module support. <code>scrypt-async-modern</code> supports older browsers, however this demo doesn't to keep things simple. Please try again in a modern browser.</h3>"
</script>
</body>

</html>
